<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>C#åŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€  - ç æœ¯-ä¸€ä¸ªçš‡é©¬çƒè¿·çš„åšå®¢è€Œå·²</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="ä¹é›¶" /><meta name="description" content="æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœå¤„ç†ä¸å½“ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸é¢„æœŸä¸ç¬¦çš„ç»“æœï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥åœ¨ç¨‹åºé‡Œæœ‰ç€ç›¸å½“é‡è¦çš„ä½œç”¨ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¸ç”¨çš„ä¸€äº›çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ–¹æ³•ã€‚ğŸ”»
" /><meta name="keywords" content="ç æœ¯" />






<meta name="generator" content="Hugo 0.81.0 with theme even" />


<link rel="canonical" href="https://jiuling.me/post/c-%E5%9F%BA%E5%85%83%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9E%84%E9%80%A0/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="C#åŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€ " />
<meta property="og:description" content="æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœå¤„ç†ä¸å½“ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸é¢„æœŸä¸ç¬¦çš„ç»“æœï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥åœ¨ç¨‹åºé‡Œæœ‰ç€ç›¸å½“é‡è¦çš„ä½œç”¨ã€‚
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¸ç”¨çš„ä¸€äº›çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ–¹æ³•ã€‚ğŸ”»" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jiuling.me/post/c-%E5%9F%BA%E5%85%83%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9E%84%E9%80%A0/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-03-01T21:54:13&#43;08:00" />
<meta property="article:modified_time" content="2021-03-01T21:54:13&#43;08:00" />

<meta itemprop="name" content="C#åŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€ ">
<meta itemprop="description" content="æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœå¤„ç†ä¸å½“ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸é¢„æœŸä¸ç¬¦çš„ç»“æœï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥åœ¨ç¨‹åºé‡Œæœ‰ç€ç›¸å½“é‡è¦çš„ä½œç”¨ã€‚
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¸ç”¨çš„ä¸€äº›çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ–¹æ³•ã€‚ğŸ”»"><meta itemprop="datePublished" content="2021-03-01T21:54:13&#43;08:00" />
<meta itemprop="dateModified" content="2021-03-01T21:54:13&#43;08:00" />
<meta itemprop="wordCount" content="5861">
<meta itemprop="keywords" content="çº¿ç¨‹åŒæ­¥,Volatile," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="C#åŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€ "/>
<meta name="twitter:description" content="æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœå¤„ç†ä¸å½“ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸é¢„æœŸä¸ç¬¦çš„ç»“æœï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥åœ¨ç¨‹åºé‡Œæœ‰ç€ç›¸å½“é‡è¦çš„ä½œç”¨ã€‚
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¸ç”¨çš„ä¸€äº›çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ–¹æ³•ã€‚ğŸ”»"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ç æœ¯</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">ä¸»é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a><a href="/about">
        <li class="mobile-menu-item">å…³äº</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ç æœ¯</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">ä¸»é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">åˆ†ç±»</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about">å…³äº</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">C#åŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€ </h1>

      <div class="post-meta">
        <span class="post-time"> 2021-03-01 </span>
        <div class="post-category">
            <a href="/categories/.net/"> .NET </a>
            </div>
          <span class="more-meta"> 5861 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ç”¨æˆ·æ¨¡å¼æ„é€ ">ç”¨æˆ·æ¨¡å¼æ„é€ </a>
      <ul>
        <li><a href="#æ˜“å˜æ„é€ ">æ˜“å˜æ„é€ </a></li>
        <li><a href="#äº’é”æ„é€ ">äº’é”æ„é€ </a></li>
        <li><a href="#å®ç°ç®€å•çš„è‡ªæ—‹é”">å®ç°ç®€å•çš„è‡ªæ—‹é”</a></li>
        <li><a href="#interlocked-anythingæ¨¡å¼"><code>Interlocked Anything</code>æ¨¡å¼</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯éå¸¸å¸¸è§çš„äº‹æƒ…ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœå¤„ç†ä¸å½“ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸é¢„æœŸä¸ç¬¦çš„ç»“æœï¼Œæ‰€ä»¥çº¿ç¨‹åŒæ­¥åœ¨ç¨‹åºé‡Œæœ‰ç€ç›¸å½“é‡è¦çš„ä½œç”¨ã€‚
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¸¸ç”¨çš„ä¸€äº›çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æ–¹æ³•ã€‚ğŸ”»</p>
<p><strong>æœ¬æ–‡åŸºäº<code>.NET4.5</code>æ¡†æ¶</strong></p>
<h1 id="ç”¨æˆ·æ¨¡å¼æ„é€ ">ç”¨æˆ·æ¨¡å¼æ„é€ </h1>
<h2 id="æ˜“å˜æ„é€ ">æ˜“å˜æ„é€ </h2>
<p><code>volatile</code>å…³é”®å­—æŒ‡ç¤ºä¸€ä¸ªå­—æ®µå¯ä»¥ç”±å¤šä¸ªåŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹ä¿®æ”¹ï¼Œé€šè¿‡<code>volatile</code>å…³é”®å­—ï¼Œå¯ä»¥ä¿è¯å˜é‡åœ¨æ‰§è¡Œä¸Šæœ‰ç€åŸå­æ€§çš„è¯»ã€å†™æ“ä½œã€‚
<code>volatile</code>å…³é”®å­—å¯åº”ç”¨äºä»¥ä¸‹ç±»å‹çš„å­—æ®µï¼š</p>
<ul>
<li>å¼•ç”¨ç±»å‹ã€‚</li>
<li>æŒ‡é’ˆç±»å‹ï¼ˆåœ¨ä¸å®‰å…¨çš„ä¸Šä¸‹æ–‡ä¸­ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œè™½ç„¶æŒ‡é’ˆæœ¬èº«å¯ä»¥æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å®ƒæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½æ˜¯å¯å˜çš„ã€‚ æ¢å¥è¯è¯´ï¼Œä¸èƒ½å£°æ˜â€œæŒ‡å‘å¯å˜å¯¹è±¡çš„æŒ‡é’ˆâ€ã€‚</li>
<li>ç®€å•ç±»å‹ï¼Œå¦‚ sbyteã€byteã€shortã€ushortã€intã€uintã€charã€float å’Œ boolã€‚</li>
<li>å…·æœ‰ä»¥ä¸‹åŸºæœ¬ç±»å‹ä¹‹ä¸€çš„ enum ç±»å‹ï¼šbyteã€sbyteã€shortã€ushortã€int æˆ– uintã€‚</li>
<li>å·²çŸ¥ä¸ºå¼•ç”¨ç±»å‹çš„æ³›å‹ç±»å‹å‚æ•°ã€‚</li>
<li>IntPtr å’Œ UIntPtrã€‚</li>
</ul>
<p>è¿™äº›æè¿°è¯»èµ·æ¥æ¯”è¾ƒç»•å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºä»¥ä¸‹<code>volatile</code>çš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// å®šä¹‰æµ‹è¯•ç±»
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">VolatileTest</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_isStop</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">void</span> <span class="n">Do</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;ä»»åŠ¡å¼€å§‹&#34;</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">th</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Thread1</span><span class="p">);</span>
            <span class="n">th</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>

            <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">5000</span><span class="p">);</span>
            <span class="n">_isStop</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;ç­‰å¾…ä»»åŠ¡å®Œæˆ&#34;</span><span class="p">);</span>
            <span class="n">th</span><span class="p">.</span><span class="n">Join</span><span class="p">();</span>

            <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="n">Thread1</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(!</span><span class="n">_isStop</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">x</span> <span class="p">=</span> <span class="n">x</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè®¡æ•°ï¼š{x}&#34;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="k">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//è°ƒç”¨æµ‹è¯•æ–¹æ³•
</span><span class="c1"></span>            <span class="k">new</span> <span class="n">VolatileTest</span><span class="p">().</span><span class="n">Do</span><span class="p">();</span>
        <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å…ˆæ¥çŒœçŒœä¸Šé¢è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœæ˜¯æ€æ ·çš„ğŸ˜“ğŸ˜“</p>
<p>ä»£ç åœ¨ç¼–è¯‘æ—¶ï¼Œæ ¹æ®ä¸åŒçš„ç¼–è¯‘é…ç½®ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸åŒçš„ç»“æœã€‚</p>
<ul>
<li>
<p>åœ¨<code>Debug</code>æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨å¹¶æ²¡æœ‰å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥ç¨‹åºä¼šå¾—åˆ°æ­£å¸¸çš„æ‰§è¡Œç»“æœğŸ”»
<img src="https://i.loli.net/2021/03/01/PvKmZLhQNtl2uM1.jpg" alt="VolatileDebug.jpg"><br>
<em>è‡³äºè¿™é‡Œçš„è®¡æ•°ä¸ºä»€ä¹ˆä¼šæ˜¯è´Ÿæ•°ï¼Œè¿™ä¸ªä»¥åæœ‰æœºä¼šåœ¨å•ç‹¬å†™æ–‡ç« åˆ†æ</em></p>
</li>
<li>
<p>åœ¨<code>Release</code>æ¨¡å¼ä¸‹,ç¼–è¯‘å™¨é»˜è®¤æ‰“å¼€äº†ä»£ç ä¼˜åŒ–åŠŸèƒ½ã€‚ç¼–è¯‘VolatileTestæ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨å‘ç°<code>_isStop</code>åœ¨<code>Thread1</code>æ–¹æ³•ä¸­å¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå¹¶ä¸”<strong>å¯¹<code>_isStop</code>çš„æ£€æŸ¥åªä¼šåœ¨å¾ªç¯å‰å‘ç”Ÿä¸€æ¬¡ï¼Œä¸ä¼šæ¯æ¬¡å¾ªç¯æ—¶éƒ½æ£€æŸ¥</strong>ã€‚å› æ­¤ä¼šç”Ÿæˆä¸€æ®µä¸€ç›´ç´¯åŠ xçš„ä»£ç å‡ºæ¥ã€‚å› æ­¤ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œå¾—åˆ°äº†ä»¥ä¸‹ç»“æœğŸ”»
<img src="https://i.loli.net/2021/03/01/qkXNTVtiIhaplEu.jpg" alt="VolatileRelease.jpg"></p>
</li>
</ul>
<p>æ¥ä¸‹æ¥é€šè¿‡<code>IL</code>ä»£ç æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„ä¸åŒï¼ˆå·¦è¾¹ä¸º<code>Debug</code>ç‰ˆæœ¬ï¼Œå³è¾¹ä¸º<code>Release</code>ç‰ˆæœ¬ï¼‰</p>
<p><img src="https://i.loli.net/2021/03/01/6GfIXBDxwCpRQkM.jpg" alt="VolatileIL.jpg"></p>
<p>åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹ä¸åŒï¼š</p>
<ol>
<li><code>Debug</code>ç‰ˆæœ¬ä¸­ï¼Œåœ¨åˆå§‹åŒ–å˜é‡æ—¶ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>bool</code>ç±»å‹çš„å˜é‡ï¼›<code>Release</code>ç‰ˆæœ¬æ²¡æœ‰</li>
<li><code>Debug</code>ç‰ˆæœ¬ä¸­ï¼Œåœ¨å¾ªç¯ç»“æŸå‰ï¼Œå¯¹å®šä¹‰çš„<code>bool</code>å˜é‡å’Œ<code>_isStop</code>è¿›è¡Œäº†è®¡ç®—ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­å¾ªç¯ï¼›<code>Release</code>ç‰ˆæœ¬ä¸­ç›´æ¥è·å–å¹¶æ ¡éªŒäº†<code>_isStop</code>çš„å€¼ï¼Œç»“æœä¸º<code>false</code>ï¼Œåˆ™æ— é™å¾ªç¯ã€‚</li>
</ol>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨å‰é¢æ‰€è¯´çš„<code>Volatile</code>å…³é”®å­—å®šä¹‰å˜é‡å³å¯ã€‚<code>Volatile</code>èƒ½ä¿è¯å˜é‡çš„åŸå­æ“ä½œï¼Œå› æ­¤ç”¨<code>Volatile</code>å®šä¹‰çš„å˜é‡ï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šè¿›è¡Œä¹‹å‰çš„ä¼˜åŒ–æ“ä½œã€‚
æ‰€ä»¥é‡æ–°ä¿®æ”¹<code>_isStop</code>å˜é‡çš„å®šä¹‰å³å¯ä¿®æ­£å‰é¢çš„é—®é¢˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#"><span class="k">private</span> <span class="n">volatile</span> <span class="kt">bool</span> <span class="n">_isStop</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦å¤–ï¼Œ<code>System.Threading.Volatile</code>ç±»è¿˜æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªé™æ€æ–¹æ³•æ¥è¿›è¡Œå˜é‡çš„è¯»å†™ğŸ”»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">            <span class="n">Volatile</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isStop</span><span class="p">);</span>
            <span class="n">Volatile</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isStop</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>å› æ­¤é€šè¿‡å¦‚ä¸‹ä»£ç ä¹Ÿå¯ä»¥ä¿®æ­£å‰é¢çš„é—®é¢˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="k">public</span> <span class="k">void</span> <span class="n">Thread1</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="c1">//è¿™é‡Œä½¿ç”¨Volatile.Readæ¥è¯»å–æœ€æ–°çš„å€¼
</span><span class="c1"></span>            <span class="k">while</span> <span class="p">(!</span><span class="n">Volatile</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isStop</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">x</span> <span class="p">=</span> <span class="n">x</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè®¡æ•°ï¼š{x}&#34;</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœå¯¹ä¸Šé¢çš„æ¦‚å¿µè¿˜æ˜¯ä¸å¤ªç†è§£ï¼Œé‚£ä¹ˆå¯ä»¥å†å‚è€ƒä¸‹ä¹¦ä¸­çš„è¿™æ ·ä¸€æ®µå®šä¹‰ğŸ”»</p>
<blockquote>
<p>å½“çº¿ç¨‹é€šè¿‡å…±äº«å†…å­˜ç›¸äº’é€šä¿¡æ—¶ï¼Œè°ƒç”¨<code>Volatile.Write</code>æ¥å†™å…¥æœ€åä¸€ä¸ªå€¼ï¼Œè°ƒç”¨<code>Volatile.Read</code>æ¥è¯»å–ç¬¬ä¸€ä¸ªå€¼</p>
</blockquote>
<h2 id="äº’é”æ„é€ ">äº’é”æ„é€ </h2>
<p><code>System.Threading.Interlocked</code>ç±»ä¸­çš„æ¯ä¸ªæ–¹æ³•éƒ½ä¸ºå¤šä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡æä¾›åŸå­æ“ä½œã€‚</p>
<blockquote>
<p>è°ƒç”¨æŸä¸ª<code>Interlocked</code>æ–¹æ³•ä¹‹å‰çš„ä»»ä½•å˜é‡å†™å…¥éƒ½åœ¨è¿™ä¸ª<code>Interlocked</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œï¼›è€Œè¿™ä¸ªè°ƒç”¨ä¹‹åçš„ä»»ä½•å˜é‡è¯»å–éƒ½åœ¨è¿™ä¸ªè°ƒç”¨ä¹‹åè¯»å–ã€‚</p>
</blockquote>
<p><em><code>volatile</code>åªæœ‰Readã€Writeä¸¤ä¸ªæ–¹æ³•æä¾›åŸå­æ€§çš„æ“ä½œï¼Œè€Œ<code>Interlocked</code>ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ‰§è¡Œä¸€æ¬¡åŸå­æ€§çš„è¯»å–å’Œå†™å…¥</em>
è¯¥ç±»æä¾›çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.interlocked?view=netframework-4.5&amp;f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(System.Threading.Interlocked);k(TargetFrameworkMoniker-.NETFramework,Version%253Dv4.5);k(DevLang-csharp)%26rd%3Dtrue">MSDNæ–‡æ¡£</a></p>
<p>ä¾ç„¶å¾ˆç»•å£å§ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸é‚£ç»§ç»­ç”¨ä»£ç æ¥ç†è§£ã€‚
è¯¥ç¤ºä¾‹ä½¿ç”¨<code>HttpClient</code>å¯¹æŒ‡å®šçš„æœåŠ¡å™¨è¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºè¯·æ±‚è¿”å›çš„å­—èŠ‚æ•°ğŸ”»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// æœåŠ¡å™¨è¯·æ±‚çŠ¶æ€
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">enum</span> <span class="n">CoordinationStatus</span>
    <span class="p">{</span>
        <span class="n">AllDone</span><span class="p">,</span>
        <span class="n">Timeout</span><span class="p">,</span>
        <span class="n">Cancel</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// å®šä¹‰æµ‹è¯•ç±»
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">InterlockedTest</span>
    <span class="p">{</span>
        <span class="c1">//è¿™ä¸ªè¾…åŠ©ç±»ç”¨äºåè°ƒæ‰€æœ‰å¼‚æ­¥æ“ä½œ
</span><span class="c1"></span>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">AsyncCoordinator</span> <span class="n">_ac</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AsyncCoordinator</span><span class="p">();</span>

        <span class="c1">//è¿™æ˜¯æƒ³è¦æŸ¥è¯¢çš„webæœåŠ¡å™¨åŠå…¶å“åº”ï¼ˆå¼‚å¸¸æˆ–intï¼‰çš„é›†åˆ
</span><span class="c1"></span>        <span class="c1">//æ³¨æ„ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®è¯¥å­—å…¸ä¸éœ€è¦ä»¥åŒæ­¥æ–¹å¼è¿›è¡Œ
</span><span class="c1"></span>        <span class="c1">//å› ä¸ºæ„é€ åé”®å°±æ˜¯åªè¯»çš„
</span><span class="c1"></span>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="p">&gt;</span> <span class="n">_remoteServers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="p">{</span><span class="s">&#34;https://www.microsoft.com&#34;</span> <span class="p">,</span><span class="k">null</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;https://www.bing.com&#34;</span><span class="p">,</span><span class="k">null</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;https://www.google.com&#34;</span><span class="p">,</span><span class="k">null</span><span class="p">}</span>
        <span class="p">};</span>
        <span class="k">public</span> <span class="k">void</span> <span class="n">Do</span><span class="p">(</span><span class="kt">int</span> <span class="n">timeout</span> <span class="p">=</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">Infinite</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">();</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">server</span> <span class="k">in</span> <span class="n">_remoteServers</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_ac</span><span class="p">.</span><span class="n">AboutToBegin</span><span class="p">(</span><span class="m">1</span><span class="p">);</span><span class="c1">//è¿™é‡Œä¹Ÿå¯ä»¥ä¿®æ”¹ä¸ºä¸‹é¢æ³¨é‡Šä¸­çš„æ–¹å¼
</span><span class="c1"></span>                <span class="n">httpClient</span><span class="p">.</span><span class="n">GetByteArrayAsync</span><span class="p">(</span><span class="n">server</span><span class="p">).</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">task</span> <span class="p">=&gt;</span> <span class="n">ComputeResult</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">task</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="c1">// //ä¸€æ¬¡æ€§å‘AboutToBeginæ–¹æ³•ä¼ é€’æ‰€æœ‰çš„è¯·æ±‚æ•°é‡
</span><span class="c1"></span>            <span class="c1">// _ac.AboutToBegin(_remoteServers.Count);
</span><span class="c1"></span>            <span class="c1">// foreach (var server in _remoteServers.Keys)
</span><span class="c1"></span>            <span class="c1">// {
</span><span class="c1"></span>            <span class="c1">//     httpClient.GetByteArrayAsync(server).ContinueWith(task =&gt; ComputeResult(server, task));
</span><span class="c1"></span>            <span class="c1">// }
</span><span class="c1"></span>
            <span class="c1">//å‘Šè¯‰AsyncCoordinatoræ‰€æœ‰æ“ä½œéƒ½å·²å‘èµ·ï¼Œå¹¶åœ¨æ‰€æœ‰æ“ä½œå®Œæˆ
</span><span class="c1"></span>            <span class="c1">//è°ƒç”¨Cancelæˆ–è€…å‘ç”Ÿè¶…æ—¶çš„æ—¶å€™è°ƒç”¨AllDone
</span><span class="c1"></span>            <span class="n">_ac</span><span class="p">.</span><span class="n">AllBegun</span><span class="p">(</span><span class="n">AllDone</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">private</span> <span class="k">void</span> <span class="n">ComputeResult</span><span class="p">(</span><span class="kt">string</span> <span class="n">server</span><span class="p">,</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Byte</span><span class="p">[]&gt;</span> <span class="n">task</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">object</span> <span class="n">result</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">Exception</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">result</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">InnerException</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">//çº¿ç¨‹æ± çº¿ç¨‹å¤„ç†I/Oå®Œæˆ
</span><span class="c1"></span>                <span class="c1">//åœ¨æ­¤æ·»åŠ è‡ªå·±çš„è®¡ç®—å¯†é›†å‹ç®—æ³•
</span><span class="c1"></span>                <span class="c1">//æœ¬ä¾‹åªæ˜¯è¿”å›é•¿åº¦
</span><span class="c1"></span>                <span class="n">result</span> <span class="p">=</span> <span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">//ä¿å­˜ç»“æœ(exception/sum)ï¼ŒæŒ‡å‡º1ä¸ªæ“ä½œå®Œæˆ
</span><span class="c1"></span>            <span class="n">_remoteServers</span><span class="p">[</span><span class="n">server</span><span class="p">]</span> <span class="p">=</span> <span class="n">result</span><span class="p">;</span>
            <span class="n">_ac</span><span class="p">.</span><span class="n">JustEnded</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//è°ƒç”¨è¿™ä¸ªæ–¹æ³•æŒ‡å‡ºç»“æœå·²æ— å…³ç´§è¦
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">void</span> <span class="n">Cancel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_ac</span><span class="p">.</span><span class="n">Cancel</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//æ‰€æœ‰WebæœåŠ¡å™¨éƒ½å“åº”ã€è°ƒç”¨äº†Cancelæˆ–è€…å‘ç”Ÿè¶…æ—¶ï¼Œå°±è°ƒç”¨è¯¥æ–¹æ³•
</span><span class="c1"></span>        <span class="k">private</span> <span class="k">void</span> <span class="n">AllDone</span><span class="p">(</span><span class="n">CoordinationStatus</span> <span class="n">status</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">Cancel</span><span class="p">:</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;è¯·æ±‚å–æ¶ˆ&#34;</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">Timeout</span><span class="p">:</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;è¯·æ±‚è¶…æ—¶&#34;</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">AllDone</span><span class="p">:</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;è¯·æ±‚å®Œæˆï¼Œç»“æœï¼š&#34;</span><span class="p">);</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">server</span> <span class="k">in</span> <span class="n">_remoteServers</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;{server.Key}&#34;</span><span class="p">);</span>
                        <span class="kt">object</span> <span class="n">result</span> <span class="p">=</span> <span class="n">server</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="k">is</span> <span class="n">Exception</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;è¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼š{result.GetType().Name}&#34;</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;è¿”å›å­—èŠ‚æ•°ï¼š{result}&#34;</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// è¿™ä¸ªè¾…åŠ©ç±»ç”¨äºåè°ƒæ‰€æœ‰å¼‚æ­¥æ“ä½œ
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">AsyncCoordinator</span>
    <span class="p">{</span>
        <span class="c1">//AllBegunå†…éƒ¨è°ƒç”¨JustEndedæ¥é€’å‡å®ƒ
</span><span class="c1"></span>        <span class="k">private</span> <span class="kt">int</span> <span class="n">_opCount</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="c1">//0 = false  1= true
</span><span class="c1"></span>        <span class="k">private</span> <span class="kt">int</span> <span class="n">_statusReported</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">CoordinationStatus</span><span class="p">&gt;</span> <span class="n">_callback</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Timer</span> <span class="n">_timer</span><span class="p">;</span>

        <span class="c1">//è¯¥æ–¹æ³•å¿…é¡»åœ¨å‘èµ·ä¸€ä¸ªæ“ä½œä¹‹å‰è°ƒç”¨
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">void</span> <span class="n">AboutToBegin</span><span class="p">(</span><span class="kt">int</span> <span class="n">opsToAdd</span> <span class="p">=</span> <span class="m">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Interlocked</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">ref</span> <span class="n">_opCount</span><span class="p">,</span> <span class="n">opsToAdd</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//è¯¥æ–¹æ³•å¿…é¡»åœ¨å¤„ç†å¥½ä¸€ä¸ªæ“ä½œçš„ç»“æœä¹‹åè°ƒç”¨
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">void</span> <span class="n">JustEnded</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Interlocked</span><span class="p">.</span><span class="n">Decrement</span><span class="p">(</span><span class="k">ref</span> <span class="n">_opCount</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">ReportStatus</span><span class="p">(</span><span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">AllDone</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//è¯¥æ–¹æ³•å¿…é¡»åœ¨å‘èµ·æ‰€æœ‰æ“ä½œä¹‹åè°ƒç”¨
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">void</span> <span class="n">AllBegun</span><span class="p">(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">CoordinationStatus</span><span class="p">&gt;</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">int</span> <span class="n">timeout</span> <span class="p">=</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">Infinite</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_callback</span> <span class="p">=</span> <span class="n">callback</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">timeout</span> <span class="p">!=</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">Infinite</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_timer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="p">(</span><span class="n">TimeExpired</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">Timeout</span><span class="p">.</span><span class="n">Infinite</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">JustEnded</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="n">TimeExpired</span><span class="p">(</span><span class="kt">object</span> <span class="n">o</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ReportStatus</span><span class="p">(</span><span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">Timeout</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="n">Cancel</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">ReportStatus</span><span class="p">(</span><span class="n">CoordinationStatus</span><span class="p">.</span><span class="n">Cancel</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="n">ReportStatus</span><span class="p">(</span><span class="n">CoordinationStatus</span> <span class="n">status</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//å¦‚æœçŠ¶æ€ä»æœªæŠ¥å‘Šè¿‡ï¼Œå°±æŠ¥å‘Šå®ƒï¼›å¦åˆ™å¿½ç•¥å®ƒ
</span><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">Interlocked</span><span class="p">.</span><span class="n">Exchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">_statusReported</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_callback</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="k">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//è°ƒç”¨æµ‹è¯•æ–¹æ³•
</span><span class="c1"></span>            <span class="k">new</span> <span class="n">InterlockedTest</span><span class="p">().</span><span class="n">Do</span><span class="p">();</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//â†“â†“â†“ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹â†“â†“â†“
</span><span class="c1"></span>
        <span class="c1">// è¯·æ±‚å®Œæˆï¼Œç»“æœï¼š
</span><span class="c1"></span>        <span class="c1">// https://www.microsoft.com
</span><span class="c1"></span>        <span class="c1">// è¿”å›å­—èŠ‚æ•°ï¼š185796
</span><span class="c1"></span>        <span class="c1">// https://www.bing.com
</span><span class="c1"></span>        <span class="c1">// è¿”å›å­—èŠ‚æ•°ï¼š114613
</span><span class="c1"></span>        <span class="c1">// https://www.google.com
</span><span class="c1"></span>        <span class="c1">// è¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼šHttpRequestException
</span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥è¯´æ˜ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ğŸ”»
1.<code>InterlockedTest</code>ç±»ä¸»è¦è´Ÿè´£å®šä¹‰ä¸€ä¸ªå¤šçº¿ç¨‹è®¿é—®ç½‘ç«™çš„å­—å…¸ï¼Œå¹¶ä¸”å¯¹å­—å…¸ä¸­çš„ç½‘ç«™è¿›è¡Œè®¿é—®ã€‚ä»»åŠ¡å¼€å§‹å‰ä¼šå‘<code>AsyncCoordinator</code>ç±»å‘é€æœ¬æ¬¡éœ€è¦è¯·æ±‚çš„æ“ä½œæ•°é‡ï¼Œæ‰€æœ‰ä»»åŠ¡åˆ›å»ºå®Œæˆåè°ƒç”¨<code>AllBegun</code>æ–¹æ³•å‘è¾…åŠ©ç±»æŠ¥å‘Šä»»åŠ¡å·²åˆ›å»ºå®Œæˆï¼Œå¹¶ä¸”ç»‘å®šä¸€ä¸ªå›è°ƒæ–¹æ³•<code>AllDone</code>ï¼ˆè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æ‰“å°æ‰€æœ‰è¯·æ±‚çš„ç»“æœï¼‰ã€‚
2.<code>AsyncCoordinator</code>ç±»ç”¨äºåè°ƒæ‰€æœ‰å¼‚æ­¥æ“ä½œï¼Œä¹‹æ‰€ä»¥å•ç‹¬æå–å‡ºæ¥ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªç±»çš„åŠŸèƒ½å¯ä»¥å¤ç”¨ã€‚è¯¥ç±»çš„ä¸¤ä¸ªå…¬å…±æ–¹æ³•<code>AboutToBegin</code>å’Œ<code>JustEnded</code>åˆ†åˆ«ç”¨äºå¯¹å†…éƒ¨ç»´æŠ¤çš„å¼‚æ­¥ä»»åŠ¡æ•°ï¼ˆ<code>_opCount</code>ï¼‰è¿›è¡ŒåŸå­çš„åŠ ã€å‡æ“ä½œï¼ˆé€šè¿‡<code>Interlocked.Add</code>ã€<code>Interlocked.Decrement</code>æ¥å®ç°ï¼‰ã€‚å½“ä»»åŠ¡æ•°ä¸º0æ—¶ï¼Œè°ƒç”¨<code>ReportStatus</code>æ–¹æ³•å‘<code>InterlockedTest</code>æŠ¥å‘Šæ‰§è¡Œç»“æœï¼Œè¯´æ˜æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å·²å®Œæˆã€‚</p>
<p>è¿™é‡Œç‰¹åˆ«è¯´æ˜ä»¥ä¸‹å‡ ä¸ªç‚¹ğŸ”»</p>
<ul>
<li><code>_opCount</code>å˜é‡çš„åˆå§‹å€¼ä¸º1ï¼ˆè€Œé0ï¼‰ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚å‡å®šåˆå§‹å€¼ä¸º0ï¼Œå½“æŸä¸€ä¸ªè¯·æ±‚åˆ°å®Œæˆåˆå¾ˆè¿…é€Ÿæ—¶ï¼ˆä¸‹ä¸€ä¸ªä»»åŠ¡è¿˜æ²¡è°ƒç”¨<code>AboutToBegin</code>çš„æ—¶å€™å½“å‰ä»»åŠ¡å°±å·²ç»å®Œæˆå¹¶ä¸”è°ƒç”¨äº†<code>JustEnded</code>æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆè¿™æ—¶å°±ä¼šå¯¼è‡´<code>AllDone</code>è¢«æå‰æ‰§è¡Œã€‚å› æ­¤åˆå§‹åŒ–æ—¶å°†<code>_opCount</code>çš„å€¼è®¾ç½®ä¸º1ï¼Œç­‰æ‰€æœ‰ä»»åŠ¡æ·»åŠ å®Œæˆåï¼Œè°ƒç”¨<code>AllBegun</code>æ–¹æ³•æ—¶å†é€šè¿‡<code>JustEnded</code>å°†é‚£ä¸ª1å‡æ‰ã€‚</li>
<li><code>_statusReported</code>å˜é‡å®é™…ä¸Šæ˜¯ä½œä¸ºä¸€ä¸ª<code>Boolean</code>æ¥ä½¿ç”¨çš„ï¼Œå› ä¸º<code>Interlocked</code>ç±»ä¸æä¾›<code>Boolean</code>ç±»å‹çš„åŸå­æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>int</code>ç±»å‹çš„å˜é‡æ¥ä»£æ›¿ã€‚</li>
<li>ç¤ºä¾‹ä¸­çš„<code>Cancel</code>æ–¹æ³•æ²¡æœ‰åšå±•ç¤ºï¼Œæƒ³è¦çœ‹æ•ˆæœçš„åŒå­¦å¯ä»¥ä¿®æ”¹ä»£ç è‡ªå·±è°ƒç”¨ã€‚</li>
<li>ç¤ºä¾‹ä¸­çš„<code>Timeout</code>æ–¹æ³•æ²¡æœ‰åšå±•ç¤ºï¼Œå› ä¸ºé»˜è®¤ä¼ é€’çš„å‚æ•°æ˜¯ä¸è¶…æ—¶ï¼Œæƒ³è¦çœ‹æ•ˆæœçš„åŒå­¦å¯ä»¥ä¿®æ”¹ä»£ç è‡ªå·±è°ƒç”¨ã€‚</li>
</ul>
<h2 id="å®ç°ç®€å•çš„è‡ªæ—‹é”">å®ç°ç®€å•çš„è‡ªæ—‹é”</h2>
<p>å‰é¢æ‰€è¯´çš„<code>Interlocked</code>çš„æ–¹æ³•å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ä¸»è¦ç”¨äºæ“ä½œ<code>Int32</code>ç±»å‹ï¼Œå¦‚æœéœ€è¦åŸå­æ€§çš„æ“ä½œç±»ä¸­çš„ä¸€ç»„å­—æ®µï¼Œ<code>Interlocked</code>å¾ˆæ˜æ˜¾æ˜¯åšä¸åˆ°çš„ã€‚æ‰€ä»¥è¿™æ—¶æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªè®©çº¿ç¨‹è‡ªæ—‹æ¨¡å—ï¼Œæ¥å®ç°ä»£ç åŒæ­¥ã€‚<br>
æ‰€è°“<strong>è‡ªæ—‹é”ï¼ˆspin lockï¼‰</strong>ï¼Œå…¶å®å°±æ˜¯åœ¨å¤šçº¿ç¨‹çš„å¤„ç†ä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹æš‚æ—¶â€œåŸåœ°æ‰“è½¬â€ï¼Œä»¥å…è·‘å»è·Ÿå¦å¤–ä¸€ä¸ªçº¿ç¨‹ç«äº‰èµ„æºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// å®šä¹‰ä¸€ä¸ªç®€å•çš„è‡ªæ—‹é”
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SpinLockTest</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_isInUse</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="n">Enter</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Interlocked</span><span class="p">.</span><span class="n">Exchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isInUse</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">//å¦‚æœæœ‰çº¿ç¨‹æ­£åœ¨è°ƒç”¨ï¼Œé‚£ä¹ˆåæ¥çš„çº¿ç¨‹å°±ä¸€ç›´åœ¨è¿™é‡Œâ€œè‡ªæ—‹â€
</span><span class="c1"></span>            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="n">Leave</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Interlocked</span><span class="p">.</span><span class="n">Exchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isInUse</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">    <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>    <span class="c1">/// ä½¿ç”¨è‡ªæ—‹é”
</span><span class="c1"></span>    <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">MySpinLock</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">SpinLockTest</span> <span class="n">_spinLockTest</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SpinLockTest</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">void</span> <span class="n">Do</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="p">(()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="c1">//å®šä¹‰100ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶å¯¹_count++
</span><span class="c1"></span>                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">th</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(()</span> <span class="p">=&gt;</span>
                    <span class="p">{</span>
                        <span class="n">_spinLockTest</span><span class="p">.</span><span class="n">Enter</span><span class="p">();</span>
                        <span class="c1">//ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å½“å‰ä»£ç å—
</span><span class="c1"></span>                        <span class="n">_count</span><span class="p">++;</span>                        
                        <span class="n">_spinLockTest</span><span class="p">.</span><span class="n">Leave</span><span class="p">();</span>
                    <span class="p">});</span>
                    <span class="n">th</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="c1">//ç­‰å¾…æ‰€æœ‰çº¿ç¨‹è°ƒç”¨å®Œæˆ
</span><span class="c1"></span>            <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">10</span> <span class="p">*</span> <span class="m">1000</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;_count={_count}&#34;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªè‡ªæ—‹é”å®é™…ä¸Šå¾ˆç®€å•<br>
å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨<code>SpinLockTest.Enter()</code>æ—¶ï¼Œé‚£ä¹ˆ<code>Interlocked.Exchange(ref _isInUse, 1)</code>ä¼šç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å°†<code>_isInUse</code>ç”±0å˜æˆ1ï¼Œå¹¶å‘ç°å…¶åˆå§‹å€¼ä¸º0ï¼Œæ‰€ä»¥è·³å‡ºå¾ªç¯å¹¶ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ï¼›å¦ä¸€ä¸ªçº¿ç¨‹å°†<code>_isInUse</code>ç”±1å˜æˆ1ï¼Œåˆå§‹å€¼ä¸º1ï¼Œæ‰€ä»¥ä¼šä¸€ç›´è¿›è¡Œâ€œè‡ªæ—‹â€ï¼Œç­‰å¾…ç›´åˆ°<code>_isInUse</code>çš„å€¼å†æ¬¡å˜ä¸º0ã€‚<br>
å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œéœ€è¦åŒæ­¥çš„ä»£ç å—åè°ƒç”¨<code>_spinLockTest.Leave()</code>æ–¹æ³•ï¼Œå°†<code>_isInUse</code>çš„å€¼å†æ¬¡å˜ä¸º0ï¼Œæ­¤æ—¶â€œè‡ªæ—‹â€çš„çº¿ç¨‹è¿›å…¥è¦åŒæ­¥çš„ä»£ç å—ã€‚</p>
<p>â€œè‡ªæ—‹é”â€è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä»¥ä¸‹çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>å› ä¸ºä¸€ç›´â€œè‡ªæ—‹â€ï¼Œæ‰€ä»¥ä¼šæµªè´¹å¤§é‡çš„CPUæ—¶é—´ï¼Œå› æ­¤è¯¥æ–¹æ³•<strong>ä»…é€‚ç”¨äºæ‰§è¡Œçš„éå¸¸å¿«çš„ä»£ç å—</strong>ã€‚</li>
<li>å¦‚æœ<strong>å ç”¨é”</strong>çš„çº¿ç¨‹ä¼˜å…ˆçº§ä½äº<strong>æƒ³è¦è·å–é”</strong>çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šå‡ºç°æ´»é”çš„æƒ…å†µï¼ˆå› ä¸ºå ç”¨é”çš„çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰æœºä¼šæ‰§è¡Œï¼‰<em>è¿™éƒ¨åˆ†ä¸ºçº¿ç¨‹ä¼˜å…ˆçº§çš„çŸ¥è¯†ï¼Œè¿™é‡Œä¸è¿‡å¤šçš„è§£é‡Š</em>ã€‚</li>
</ul>
<h2 id="interlocked-anythingæ¨¡å¼"><code>Interlocked Anything</code>æ¨¡å¼</h2>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨<code>Interlocked</code>æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå‘ç°å®ƒæœ‰å¥½å¤šå¸¸ç”¨çš„æ“ä½œéƒ½ä¸æ”¯æŒï¼Œæ¯”å¦‚<code>Min</code>ã€<code>Max</code>ã€<code>And</code>ã€<code>Or</code>ã€<code>Xor</code>ç­‰ï¼Œä½†æ˜¯<code>Interlocked</code>æä¾›äº†ä¸€ä¸ªæ–¹æ³•<code>Interlocked.CompareExchange</code>ï¼Œå¯ä»¥è¿›è¡Œä¸¤ä¸ªæ•°çš„æ¯”è¾ƒã€‚æˆ‘ä»¬æ‰€è¯´çš„ <strong><code>Interlocked Anything</code>æ¨¡å¼</strong> å°±æ˜¯è¿ç”¨äº†è¯¥æ–¹æ³•æ‰©å±•å‡ºæ¥çš„ä¸€ç§å†™æ³•ã€‚</p>
<p><strong><code>Interlocked Anything</code>æ¨¡å¼</strong>æœ‰ç‚¹ç±»ä¼¼æ•°æ®åº“çš„ä¹è§‚å¹¶å‘æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨è¯¥æ¨¡å¼æ¥å®ç°ä¸€ä¸ªåŸå­çš„<code>Max</code>æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¹è§‚é”çš„ç‰¹ç‚¹ï¼šåœ¨æäº¤æ•°æ®æ›´æ–°ä¹‹å‰ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šå…ˆæ£€æŸ¥åœ¨è¯¥äº‹åŠ¡è¯»å–æ•°æ®ä¹‹åï¼Œæœ‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡åˆä¿®æ”¹äº†è¯¥æ•°æ®ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡æ›´æ–°äº†è¯¥æ•°æ®ï¼Œæ­£åœ¨æäº¤çš„äº‹åŠ¡å°†ä¼šè¿›è¡Œå›æ»šã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="c1">/// &lt;summary&gt;
</span><span class="c1"></span>        <span class="c1">/// è·å–ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼
</span><span class="c1"></span>        <span class="c1">/// &lt;/summary&gt;
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">Max</span><span class="p">(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="k">value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">currentVal</span> <span class="p">=</span> <span class="n">target</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">startVal</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">desiredVal</span><span class="p">;</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="c1">//è®°å½•æœ¬æ¬¡å¾ªç¯å¼€å§‹çš„èµ·å§‹å€¼
</span><span class="c1"></span>                <span class="n">startVal</span> <span class="p">=</span> <span class="n">currentVal</span><span class="p">;</span>

                <span class="c1">//å¯ä»¥ç”¨startValæ‰§è¡Œä½ å¸Œæœ›çš„ä»»ä½•æ“ä½œï¼Œæœ¬ä¾‹ä»¥è·å–æœ€å¤§å€¼ä¸ºä¾‹
</span><span class="c1"></span>                <span class="n">desiredVal</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">startVal</span><span class="p">,</span> <span class="k">value</span><span class="p">);</span>

                <span class="c1">//è¿”å›targetçš„åŸå§‹å€¼ï¼ˆä¿®æ”¹å‰çš„å€¼ï¼Œå› ä¸ºæ‰§è¡Œä»£ç æœŸé—´è¯¥å€¼å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼‰
</span><span class="c1"></span>                <span class="n">currentVal</span> <span class="p">=</span> <span class="n">Interlocked</span><span class="p">.</span><span class="n">CompareExchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">target</span><span class="p">,</span> <span class="n">desiredVal</span><span class="p">,</span> <span class="n">startVal</span><span class="p">);</span>

                <span class="c1">//å¦‚æœtargetçš„å€¼è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆcurrentValçš„å€¼å°±ä¸ä¼šç­‰äºstartValå€¼
</span><span class="c1"></span>                <span class="c1">//é‡æ–°å¾ªç¯ä¸€æ¬¡ç”¨æœ€æ–°å€¼è¿›è¡Œè®¡ç®—
</span><span class="c1"></span>            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">startVal</span> <span class="p">!=</span> <span class="n">currentVal</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">desiredVal</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ç»“åˆå‰é¢æ‰€è¯´çš„ä¹è§‚é”çš„ç‰¹ç‚¹ï¼Œç°åœ¨æ¥åˆ†æä»¥ä¸‹è¿™æ®µä»£ç ã€‚</p>
<ol>
<li>è¿›å…¥æ–¹æ³•å<code>currentVal</code>å€¼è¢«åˆå§‹åŒ–ä¸º<code>target</code>çš„å€¼</li>
<li>å¾ªç¯å¼€å§‹åï¼Œåˆå§‹åŒ–æœ¬æ¬¡æ“ä½œçš„èµ·å§‹å€¼<code>startVal</code></li>
<li>æ‰§è¡Œéœ€è¦çš„ä»£ç æ“ä½œï¼ˆæœ¬ä¾‹ä»¥è·å–ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ä¸ºä¾‹ï¼‰</li>
<li>æ“ä½œå®Œæˆåï¼Œè°ƒç”¨<code>Interlocked.CompareExchange</code>æ–¹æ³•æ¯”è¾ƒ<code>target</code>å’Œ<code>startVal</code>æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™å°†<code>desiredVal</code>èµ‹å€¼ç»™<code>target</code>ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€æ­¥çš„æ“ä½œç»“æœï¼‰ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œ<code>target</code>å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™æ—¶å°†æœ€æ–°çš„å€¼èµ‹å€¼ç»™<code>currentVal</code></li>
<li>å¦‚æœä¸Šä¸€æ­¥çš„<code>target</code>å’Œ<code>startVal</code>ç›¸ç­‰ï¼Œé‚£ä¹ˆ<code>Interlocked.CompareExchange</code>æ–¹æ³•çš„è¿”å›å€¼<code>currentVal</code>ï¼Œä¹Ÿå°†å’Œå‰é¢ä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œæ­¤æ—¶è·³å‡ºå¾ªç¯ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæˆã€‚å¦‚æœ<code>target</code>å’Œ<code>startVal</code>ä¸ç›¸ç­‰ï¼Œåˆ™ç”¨æœ€æ–°çš„<code>target</code>å€¼ï¼ˆå³<code>currentVal</code>ï¼‰é‡æ–°è¿›è¡Œå¾ªç¯ã€‚</li>
</ol>
<p>ã€ŠCLR via C#ã€‹çš„ä½œè€…åœ¨ä¹¦ä¸­å†™é“ï¼Œè‡ªå·±åœ¨å¤§é‡çš„ä»£ç ä¸­éƒ½è¿ç”¨äº†è¿™ä¸ªæ¨¡å¼ï¼Œè¿˜ä¸“é—¨å†™äº†ä¸€ä¸ªæ³›å‹çš„<code>Morph</code>æ¥å°è£…äº†è¿™ä¸ªæ¨¡å¼ã€‚å¦‚ä¸‹ğŸ”»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="k">public</span> <span class="k">delegate</span> <span class="kt">int</span> <span class="n">Morpher</span><span class="p">&lt;</span><span class="n">TResult</span><span class="p">,</span> <span class="n">TArgument</span><span class="p">&gt;(</span><span class="kt">int</span> <span class="n">startValue</span><span class="p">,</span> <span class="n">TArgument</span> <span class="n">argument</span><span class="p">,</span> <span class="k">out</span> <span class="n">TResult</span> <span class="n">morphResult</span><span class="p">);</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">TResult</span> <span class="n">Morph</span><span class="p">&lt;</span><span class="n">TResult</span><span class="p">,</span> <span class="n">TArgument</span><span class="p">&gt;(</span><span class="k">ref</span> <span class="kt">int</span> <span class="n">target</span><span class="p">,</span> <span class="n">TArgument</span> <span class="n">argument</span><span class="p">,</span> <span class="n">Morpher</span><span class="p">&lt;</span><span class="n">TResult</span><span class="p">,</span> <span class="n">TArgument</span><span class="p">&gt;</span> <span class="n">morpher</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TResult</span> <span class="n">morphResult</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">currentVal</span> <span class="p">=</span> <span class="n">target</span><span class="p">,</span> <span class="n">startVal</span><span class="p">,</span> <span class="n">desiredVal</span><span class="p">;</span>
            <span class="k">do</span>
            <span class="p">{</span>
                <span class="n">startVal</span> <span class="p">=</span> <span class="n">currentVal</span><span class="p">;</span>
                <span class="n">desiredVal</span> <span class="p">=</span> <span class="n">morpher</span><span class="p">(</span><span class="n">startVal</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="k">out</span> <span class="n">morphResult</span><span class="p">);</span>
                <span class="n">currentVal</span> <span class="p">=</span> <span class="n">Interlocked</span><span class="p">.</span><span class="n">CompareExchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">target</span><span class="p">,</span> <span class="n">desiredVal</span><span class="p">,</span> <span class="n">startVal</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">startVal</span> <span class="p">!=</span> <span class="n">currentVal</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">morphResult</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C#" data-lang="C#">        <span class="k">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//è°ƒç”¨æµ‹è¯•æ–¹æ³•ï¼ŒåŒæ ·å·²Maxä¸ºä¾‹
</span><span class="c1"></span>            <span class="kt">int</span> <span class="n">a</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">b</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">a1</span> <span class="p">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="n">InterlockedAnythingTest</span><span class="p">.</span><span class="n">Morph</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="k">ref</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="k">out</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">z</span> <span class="p">=</span> <span class="m">999</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">Math</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">;</span>
            <span class="p">});</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&#34;max value={a},return value={c}&#34;</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>

            <span class="c1">//â†“â†“â†“ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹â†“â†“â†“            
</span><span class="c1"></span>
            <span class="c1">//max value=3,return value=999
</span></code></pre></td></tr></table>
</div>
</div><p>å‚è€ƒèµ„æ–™ï¼š<br>
ã€ŠCLR via C#ã€‹<br>
<a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/keywords/volatile?f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(volatile_CSharpKeyword);k(TargetFrameworkMoniker-.NETFramework,Version%253Dv4.5);k(DevLang-csharp)%26rd%3Dtrue">volatileï¼ˆC# å‚è€ƒï¼‰ï¼ˆMSDNï¼‰</a><br>
<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.interlocked?view=netframework-4.5&amp;f1url=%3FappId%3DDev16IDEF1%26l%3DZH-CN%26k%3Dk(System.Threading.Interlocked);k(TargetFrameworkMoniker-.NETFramework,Version%253Dv4.5);k(DevLang-csharp)%26rd%3Dtrue">Interlocked ç±»ï¼ˆMSDNï¼‰</a></p>
<p><em><strong>æœ¬æ–‡æœªå®Œï¼Œåé¢è¿˜ä¼šæŒç»­æ›´æ–°ï¼Œå­¦ä¸€ç‚¹æ€»ç»“ä¸€ç‚¹</strong></em>ğŸ¶ğŸ¶</p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">ä¹é›¶</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-03-01
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/">çº¿ç¨‹åŒæ­¥</a>
          <a href="/tags/volatile/">Volatile</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/">
            <span class="next-text nav-default">è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
</div>

<div class="copyright">
  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>ä¹é›¶</span>
    <span>| Powered by<a class="hexo-link" href="https://gohugo.io"> Hugo</a></span>
    <span>| Theme -<a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even"> Even</a></span>    
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>








</body>
</html>
